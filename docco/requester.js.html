<!DOCTYPE html>

<html>
<head>
  <title>requester.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>

      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">


                <a class="source" href="basin.js.html">
                  basin.js
                </a>


                <a class="source" href="caller.js.html">
                  caller.js
                </a>


                <a class="source" href="client.js.html">
                  client.js
                </a>


                <a class="source" href="conduit.js.html">
                  conduit.js
                </a>


                <a class="source" href="consumer.js.html">
                  consumer.js
                </a>


                <a class="source" href="dispatcher.js.html">
                  dispatcher.js
                </a>


                <a class="source" href="example.js.html">
                  example.js
                </a>


                <a class="source" href="header.js.html">
                  header.js
                </a>


                <a class="source" href="middleware.js.html">
                  middleware.js
                </a>


                <a class="source" href="multiplexer.js.html">
                  multiplexer.js
                </a>


                <a class="source" href="procedure.js.html">
                  procedure.js
                </a>


                <a class="source" href="requester.js.html">
                  requester.js
                </a>


                <a class="source" href="responder.js.html">
                  responder.js
                </a>


                <a class="source" href="sender.js.html">
                  sender.js
                </a>


                <a class="source" href="server.js.html">
                  server.js
                </a>


                <a class="source" href="socket.js.html">
                  socket.js
                </a>


                <a class="source" href="spigot.js.html">
                  spigot.js
                </a>


                <a class="source" href="timeout.js.html">
                  timeout.js
                </a>


                <a class="source" href="window.js.html">
                  window.js
                </a>

            </div>
          </div>
        </li>
      </ul>

    <ul class="sections">

          <li id="title">
              <div class="annotation">
                  <h1>requester.js</h1>
              </div>
          </li>



        <li id="section-1">
            <div class="annotation">

              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <p>Control-flow utilities.</p>

            </div>

            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> cadence = <span class="hljs-built_in">require</span>(<span class="hljs-string">'cadence'</span>)

</pre></div></div>

        </li>


        <li id="section-2">
            <div class="annotation">

              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>Read and write streams with error-first callbacks.</p>

            </div>

            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> Staccato = <span class="hljs-built_in">require</span>(<span class="hljs-string">'staccato'</span>)

</pre></div></div>

        </li>


        <li id="section-3">
            <div class="annotation">

              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>Return the first not null-like value.</p>

            </div>

            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> coalesce = <span class="hljs-built_in">require</span>(<span class="hljs-string">'extant'</span>)

</pre></div></div>

        </li>


        <li id="section-4">
            <div class="annotation">

              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Do nothing.</p>

            </div>

            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> nop = <span class="hljs-built_in">require</span>(<span class="hljs-string">'nop'</span>)

</pre></div></div>

        </li>


        <li id="section-5">
            <div class="annotation">

              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Proxied header constructor.</p>

            </div>

            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> Header = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./header'</span>)

</pre></div></div>

        </li>


        <li id="section-6">
            <div class="annotation">

              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>An evented message queue.</p>

            </div>

            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> Procession = <span class="hljs-built_in">require</span>(<span class="hljs-string">'procession'</span>)

</pre></div></div>

        </li>


        <li id="section-7">
            <div class="annotation">

              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Controlled demolition of asynchronous operations.</p>

            </div>

            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> Destructible = <span class="hljs-built_in">require</span>(<span class="hljs-string">'destructible'</span>)

</pre></div></div>

        </li>


        <li id="section-8">
            <div class="annotation">

              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Pluck a shutdown timeout if it is the first argument to a constructor.</p>

            </div>

            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> Timeout = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./timeout'</span>)

</pre></div></div>

        </li>


        <li id="section-9">
            <div class="annotation">

              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Send a Node.js HTTP stream over a Conduit event stream.</p>

            </div>

            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> Sender = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./sender'</span>)

</pre></div></div>

        </li>


        <li id="section-10">
            <div class="annotation">

              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Convert a Conduit event stream into an HTTP write.</p>

            </div>

            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> Consumer = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./consumer'</span>)

</pre></div></div>

        </li>


        <li id="section-11">
            <div class="annotation">

              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Create a new request that proxies the given Node.js HTTP request and response
through the given Conduit client. An optional rewrite function can be used to
amend the HTTP headers before the request is proxied.</p>

            </div>

        </li>


        <li id="section-12">
            <div class="annotation">

              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>

            </div>

            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Request</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> vargs = <span class="hljs-built_in">Array</span>.prototype.slice.call(<span class="hljs-built_in">arguments</span>)
    <span class="hljs-keyword">var</span> timeout = Timeout(<span class="hljs-number">15000</span>, vargs)
    <span class="hljs-keyword">this</span>._client = vargs.shift()
    <span class="hljs-keyword">this</span>._rewrite = coalesce(vargs.shift(), nop)
    <span class="hljs-keyword">this</span>._destructible = <span class="hljs-keyword">new</span> Destructible(timeout, <span class="hljs-string">'conduit/request'</span>)
}

</pre></div></div>

        </li>


        <li id="section-13">
            <div class="annotation">

              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p><a href="http://stackoverflow.com/a/5426648">http://stackoverflow.com/a/5426648</a></p>

            </div>

            <div class="content"><div class='highlight'><pre>Request.prototype.middleware = cadence(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">async, request, response</span>) </span>{
    <span class="hljs-keyword">var</span> receiver = { <span class="hljs-attr">read</span>: <span class="hljs-keyword">new</span> Procession, <span class="hljs-attr">write</span>: <span class="hljs-keyword">new</span> Procession }
    <span class="hljs-keyword">var</span> responder = <span class="hljs-keyword">new</span> Consumer(response, <span class="hljs-string">'conduit/middleware'</span>)
    receiver.write.shifter().pump(responder, <span class="hljs-string">'enqueue'</span>)
    <span class="hljs-keyword">var</span> header = <span class="hljs-keyword">new</span> Header(request)
    <span class="hljs-keyword">this</span>._rewrite.call(<span class="hljs-literal">null</span>, header)
    <span class="hljs-keyword">this</span>._client.connect({
        <span class="hljs-attr">module</span>: <span class="hljs-string">'conduit/requester'</span>,
        <span class="hljs-attr">method</span>: <span class="hljs-string">'header'</span>,
        <span class="hljs-attr">body</span>: header
    }, receiver)
    Sender(request, receiver.read, <span class="hljs-string">'conduit/requester'</span>, <span class="hljs-keyword">async</span>())
})

<span class="hljs-built_in">module</span>.exports = Request

</pre></div></div>

        </li>

    </ul>
  </div>
</body>
</html>
